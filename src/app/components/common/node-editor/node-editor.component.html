<div>
  <div class="navbar-item pb-0">
    <div>
      <nav class="breadcrumb mb-2" aria-label="breadcrumbs">
        <ul>
          <li *ngIf="from=='south'">
            <a [routerLink]="['/flow/editor/south']">South</a>
          </li>
          <li *ngIf="from=='north'">
            <a [routerLink]="['/flow/editor/north']">North</a>
          </li>
          <li [ngClass]="{'is-active' : !source || !isAddFilterWizard}" *ngIf="source">
            <a [routerLink]="['/flow/editor', from, source, 'details']">
              {{source ? source : 'Add'}}
            </a>
          </li>
          <li class="is-active" *ngIf="source  && isAddFilterWizard">
            <a href="#" aria-current="page">
              Add Filter
            </a>
          </li>
        </ul>
      </nav>
      <ng-container *ngIf="source && !isAddFilterWizard">
        <button type="button" (click)="reload()" class="button is-small" title="Reload" id="refresh-check">
          <i class="fa fa-sm fa-sync" aria-hidden="true"></i>
        </button>
      </ng-container>
    </div>
    <ng-container *ngIf="source && rolesService.hasEditPermissions() && !isAddFilterWizard">
      <button class="button is-small is-link mb-1" (click)="save()">Save</button>
    </ng-container>
  </div>
  <ng-container *ngIf="!isAddFilterWizard">
    <div class="rete" #rete></div>
  </ng-container>
  <ng-contafiner *ngIf="source && isAddFilterWizard">
    <div class="box animated slideInRight">
      <app-add-filter-wizard (notify)="onNotify($event)" [serviceName]="source" [from]="from"></app-add-filter-wizard>
    </div>
  </ng-contafiner>
  <!-- Quick View -->
  <app-quickview>
    <ng-container *ngIf="showPluginConfiguration">
      <app-configuration-group *ngIf="category" [category]="category" [from]="'south'" [sourceName]="serviceName"
        (changedConfigEvent)="getChangedConfig($event)"
        (changedAdvanceConfigEvent)="getChangedAdvanceConfiguration($event)"
        (formStatusEvent)="validConfigurationForm = $event"></app-configuration-group>
      <div class="container is-fluid" *ngIf="category">
        <div class="columns" *ngIf="rolesService.hasEditPermissions()">
          <div class="column">
            <button [disabled]="checkFormState()" [appDisableUntilResponse]="reenableButton"
              class="button is-small is-link ml-4" (click)="saveConfiguration()">Save</button>
          </div>
        </div>
      </div>
    </ng-container>
    <ng-container *ngIf="showFilterConfiguration">
      <app-configuration-group *ngIf="filterCategory" [category]="filterCategory" [sourceName]="quickviewFilterName"
        (changedConfigEvent)="getChangedFilterConfig($event)" (formStatusEvent)="validFilterConfigForm = $event">
      </app-configuration-group>
      <div class="container is-fluid" *ngIf="filterCategory">
        <div class="columns" *ngIf="rolesService.hasEditPermissions()">
          <div class="column">
            <button [disabled]="checkFilterFormState()" [appDisableUntilResponse]="reenableButton"
              class="button is-small is-link ml-4" (click)="saveFilterConfiguration()">Save</button>
          </div>
        </div>
      </div>
    </ng-container>
    <ng-container *ngIf="showLogs">
      <app-system-log [sourceName]="serviceName"></app-system-log>
    </ng-container>
    <ng-container *ngIf="showTaskSchedule">
      <app-task-schedule [taskSchedule]="taskSchedule"></app-task-schedule>
    </ng-container>
    <ng-container *ngIf="showReadings">
      <div class="container is-fluid">
        <nav class="breadcrumb readings-breadcrumb" aria-label="breadcrumbs">
          <ul>
            <li class="is-active"><a>{{serviceName}}</a></li>
            <li class="is-active">
              <a href="#" aria-current="page">Readings</a>
            </li>
          </ul>
        </nav>
        <table class="table is-responsive mt-4">
          <thead>
            <tr>
              <th class="align-th">Asset</th>
              <th></th>
              <th class="align-th">Readings Count</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor='let data of service?.assets'>
                <td>
                  <a *ngIf="developerFeaturesService.getDeveloperFeatureControl() && rolesService.hasEditPermissions()"
                    class="deprecate"
                    (click)="selectAsset(data?.asset);openModal('asset-tracking-dialog')">
                    <span class="icon is-small tooltip has-tooltip-right has-tooltip-arrow"
                      data-tooltip="Deprecate asset">
                      <i class="bi bi-eraser"></i>
                    </span>
                  </a>
                  <small>{{data.asset}}</small>
                </td>
                <td>
                </td>
                <td class="readings-count">
                  <small class="level-right">{{data.count | number}}</small>
                </td>
            </tr>
          </tbody>
        </table>
        <button [appDisableUntilResponse]="reenableButton"
          class="button is-small" (click)="getAssetReadings(service)">Export Readings</button>
      </div>
    </ng-container>
  </app-quickview>
</div>

<app-confirmation-dialog id="delete-service-dialog" *ngIf="rolesService.hasEditPermissions()">
  <header class="modal-card-head">
    <span class="modal-card-title is-size-6">
      {{ task && task?.execution == "task" ? "Delete Task":"Delete Service"}}
    </span>
    <button class="delete" aria-label="close" (click)="closeModal('delete-service-dialog')"></button>
  </header>
  <section class="modal-card-body">
    Deleting {{deleteServiceName}} {{ task && task?.execution == "task"? 'task':'service'}} cannot be undone. Continue?
  </section>
  <footer class="modal-card-foot">
    <button class="button is-small" (click)="closeModal('delete-service-dialog')">Cancel</button>
    <button class="button is-small is-danger" (click)="deleteService()"
      [appDisableUntilResponse]="reenableButton">Delete</button>
  </footer>
</app-confirmation-dialog>

<app-confirmation-dialog id="delete-filter-dialog" *ngIf="rolesService.hasEditPermissions()">
  <header class="modal-card-head">
    <span class="modal-card-title is-size-6">Delete Filter</span>
    <button class="delete" aria-label="close" (click)="closeModal('delete-filter-dialog')"></button>
  </header>
  <section class="modal-card-body">
    Deleting {{filterName}} filter cannot be undone. Continue?
  </section>
  <footer class="modal-card-foot">
    <button class="button is-small" (click)="closeModal('delete-filter-dialog')">Cancel</button>
    <button class="button is-small is-danger" (click)="deleteFilterFromPipeline()"
      [appDisableUntilResponse]="reenableButton">Delete</button>
  </footer>
</app-confirmation-dialog>
<!-- <app-task-schedule #taskScheduleComponent [taskSchedule]="taskSchedule"></app-task-schedule> -->

<app-confirmation-dialog id="asset-tracking-dialog">
  <header class="modal-card-head">
    <span class="modal-card-title is-size-6">Deprecate</span>
    <button class="delete" aria-label="close" (click)="closeModal('asset-tracking-dialog')"></button>
  </header>
  <section class="modal-card-body">
    Are you sure, <b>{{selectedAsset}}</b> will be deprecated if this action is continued?
  </section>
  <footer class="modal-card-foot">
    <button class="button is-small" (click)="closeModal('asset-tracking-dialog')">Cancel</button>
    <button class="button is-small is-danger" (click)="deprecateAsset(selectedAsset)">Yes</button>
  </footer>
</app-confirmation-dialog>
